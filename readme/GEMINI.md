# Gemini Project Context: Here4 GPS DroneCAN Toolkit

## 1. Project Overview

This project has evolved into a comprehensive toolkit for interfacing with a Here4 GPS module over a DroneCAN bus. It provides several utilities for capturing, decoding, logging, visualizing, and bridging GNSS data.

The core functionality remains centered around the `dronecan` library, acting as a DroneCAN master to perform dynamic node ID allocation for the Here4 GPS. The project now includes three primary applications:

1.  **`here4_tui.py`**: A real-time, terminal-based user interface (TUI) built with the `curses` library to display live GNSS data.
2.  **`here4_sat.py`**: An advanced data logger that captures detailed GNSS and satellite quality information into two separate CSV files.
3.  **`here4_ros.py`**: A bridge to the Robot Operating System (ROS 2), publishing GNSS data to standard ROS topics for integration with larger robotics systems.

The inclusion of `pandas` and `matplotlib` in the dependencies suggests that the project also supports data analysis and plotting, likely within the `test` or `data` directories.

## 2. Building and Running

### 2.1. Hardware & OS Setup

- **Hardware**: Raspberry Pi with a CAN HAT (e.g., Waveshare 2-CH CAN-FD HAT).
- **Connection**: Here4 GPS connected to a CAN interface (e.g., `can1`) with proper termination.
- **OS**: The CAN interface must be enabled in the OS (e.g., via `/boot/config.txt`).

### 2.2. Dependencies

The project uses a Python virtual environment. 

1.  **Install System Dependencies:**
    ```bash
    sudo apt-get update
    sudo apt-get install can-utils
    ```

2.  **Set up Python Environment:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    pip install -r requirements.txt
    ```

3.  **Set Capabilities (for non-root execution):**
    To allow the Python executable in the virtual environment to access raw CAN sockets without `sudo`, grant it the necessary capabilities:
    ```bash
    sudo setcap 'cap_net_raw,cap_net_admin+eip' "$(readlink -f ./venv/bin/python3)"
    ```

### 2.3. Running the Applications

First, ensure your CAN interface is up:
```bash
sudo ip link set can1 up type can bitrate 1000000
```

Then, run one of the main scripts:

- **Live Terminal UI:**
  ```bash
  python3 here4_tui.py
  ```

- **Advanced Data Logger:**
  ```bash
  python3 here4_sat.py
  ```

- **ROS 2 Bridge:**
  ```bash
  # Source your ROS 2 environment first
  source /opt/ros/humble/setup.bash 
  python3 here4_ros.py
  ```

## 3. Key Files and Directories

- **`here4_tui.py`**: A real-time, `curses`-based terminal dashboard for live data visualization.
- **`here4_sat.py`**: A comprehensive CSV logger for GNSS position and satellite quality data.
- **`here4_ros.py`**: A bridge that publishes Here4 data to ROS 2 topics (`/fix`, `/gps/vel`, etc.).
- **`requirements.txt`**: Lists all Python dependencies, including `dronecan`, `python-can`, `pandas`, and `matplotlib`.
- **`readme/`**: Contains project documentation, including `here4_can.md`.
- **`data/`**: (Presumed) For storing data files, such as the CSV logs generated by the scripts.
- **`test/`**: (Presumed) For holding test scripts, potentially for data analysis or plotting.